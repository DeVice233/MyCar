@model IEnumerable<ModelsApi.CarApi>
@using ModelsApi
@using MyCar.Web.Core;
@{
    ViewData["Title"] = "Каталог";
}

@{
    var warehousesCard = await Api.GetListAsync<List<WareHouseApi>>("Warehouse");
    var saleCars = await Api.GetListAsync<List<SaleCarApi>>("CarSales");
}

<div class="row align-items-center justify-content-center">
    <div class="row w-100" style="background-image: url('/image/bg_13.jpg'); height: 184px; justify-content: center; align-items: center; text-align:center;">
        <h3 class="text-center text-white" style="justify-content: center;">
            Каталог авто
        </h3>
    </div>
    <section class="main-content">
        <div class="container">
            <div class="row justify-content-center text-center">
                <div class="col-md-8 col-lg-6">
                    <div class="header mb-5 mt-5">
                        <h2 class="text-white">Каталог авто</h2>
                    </div>
                </div>
            </div>

            <section class="search-sec">
                <div class="container">
                    <form method="get" asp-action="SearchCar" asp-controller="Home">
                        <div class="row">
                            <div class="col-lg-12">
                                <div class="row">
                                    <div class="col-lg-3 col-md-3 col-sm-12 p-0">
                                        <input type="text" name="SearchString" class="form-control search-slt" placeholder="Поиск..">
                                    </div>
                                    <div class="col-lg-3 col-md-3 col-sm-12 p-0">
                                      @*<select name="SortString">
                                            <option value="Цена авто">Цена авто</option>
                                            <option value="Авто">Авто</option>
                                        </select>*@
                                        <select name="FilterString" class="form-control search-slt">
                                            <option hidden>Тип поиска</option>
                                            <option value="Цена">Цена авто</option>
                                            <option value="Название">Название</option>
                                            <option value="Модель">Модель</option>
                                        </select>
                                    </div>
                                    <div class="col-lg-3 col-md-3 col-sm-12 p-0">
                                        <select name="SortString" class="form-control search-slt">
                                            <option hidden>Тип сортировки</option>
                                            <option value="По умолчанию">По умолчанию</option>
                                            <option value="По возрастанию">По возрастанию</option>
                                            <option value="По убыванию">По убыванию</option>
                                        </select>
                                    </div>
                                    <div class="col-lg-3 col-md-3 col-sm-12 p-0">
                                        <button type="submit" class="btn btn-dark wrn-btn">Искать</button>
                                    </div>
                                </div>
                            </div>

                        </div>
                    </form>
                    <section class="main-content mb-5 mt-5">
                        <div class="container">
                            <div class="row row-cols-6">
                                @foreach (var i in ViewBag.MarkCars)
                                {
                                    <div class="col">
                                        <div class="m-3 d-flex justify-content-center">
                                            <div class="mark-Photo">
                                                <a asp-controller="Home" asp-action="GetAuto" asp-route-id="@i.ID"><img src="~/MarkImages/@i.MarkPhoto" /></a>
                                            </div>
                                        </div>
                                    </div>
                                }
                            </div>
                        </div>
                    </section>
                </div>
             </section>
             <section class="row form-check form-switch text-center" style="align-items: center; justify-content: center;">
                <label class="checkbox-green">
	                <input type="checkbox" onclick="myClickFunction()">
	                <span class="checkbox-green-switch" style="width: 200px; font-size: 16px;" data-label-on="List" data-label-off="Card"></span>
                </label>
             </section>
             <div style="display: none; background-color: #171717;" id="myDIV1">
                @foreach (var i in Model)
                {
                    <div class="card mb-3" style="max-width: 100%; background-color: #171717;">
                        <div class="row g-0">
                            <div class="col-md-2">
                                <img src="~/CarImages/@i.PhotoCar" width="200px" height="150px" class="img-fluid rounded-start">
                            </div>
                            <div class="col-md-6">
                                <div class="card-body">
                                    <div class="row">
                                    <div class="col-md-5">           
                                        <table class="table">
                                            <thead>
                                                <tr>
                                                    <th style="color: white; width: 60%">
                                                        Характеристики двигателя
                                                    </th>
                                                    <th style="color: white; width: 40%">
                                                        Ед. Измерения
                                                    </th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                @foreach(var characteristic in @i.CharacteristicCars?.Where(s=> s.Characteristic.CharacteristicName.Contains("Мощность") ||
                                                s.Characteristic.CharacteristicName.Contains("Объем") || 
                                                s.Characteristic.CharacteristicName.Contains("Вместительность топливного бака")))
                                                {
                                                    <tr>
                                                        <td style="color: white; width: 60%">
                                                            @characteristic.Characteristic.CharacteristicName:
                                                        </td>
                                                        <td style="color: white; width: 40%">
                                                            @characteristic.CharacteristicValue
                                                        </td>
                                                    </tr>
                                                }
                                            </tbody>
                                        </table>
                                    </div>
                                    <div class="col-md-5">
                                        <table class="table">
                                            <thead>
                                                <tr>
                                                    <th style="color: white; width: 60%">
                                                        Скоростные характеристики
                                                    </th>
                                                    <th style="color: white; width: 40%">
                                                        Ед. Измерения
                                                    </th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                @foreach(var characteristic in @i.CharacteristicCars?.Where(s=> s.Characteristic.CharacteristicName.Contains("Макс. Скорость") ||
                                                s.Characteristic.CharacteristicName.Contains("0-100")))
                                                {
                                                    <tr>
                                                        <td style="color: white;">
                                                            @characteristic.Characteristic.CharacteristicName:
                                                        </td>
                                                        <td style="color: white;">
                                                            @characteristic.CharacteristicValue
                                                        </td>
                                                    </tr>
                                                }
                                            </tbody>
                                        </table>
                                    </div>
                                    </div>

                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="row align-items-center justify-content-center">
                                    <div class="h-100 col-6 text-center" style="align-items: center;">
                                        <img src="~/MarkImages/@i.Model.MarkCar.MarkPhoto" width="75px" height="75px" class="img-fluid rounded-start" style="justify-content:center;">
                                    </div>
                                    <div class="col-6 text-center align-items-center justify-content-center">
                                        <p class="text-white">Цена авто: </p>
                                        <h4 class="text-white">
                                            @i.CarPrice
                                        </h4>
                                        @*@{
                                            var ware = warehousesCard.Where(s => s.SaleCarId == i.ID).ToList().Sum(s=> s.CountChange);
                                            //ViewBag.DiscountPrice = DiscountCounter.GetDiscount(i);
                                            if(ware.Value <= 0)
                                            {
                                                    <h4 class="text-white">
                                                        Отсутствует в продаже
                                                    </h4>
                                                    <div class="product-price">
                                                    </div>
                                            }
                                            else
                                            {
                                                if(ViewBag.DiscountPrice == 0)
                                                {
                                                    ViewBag.DiscountPrice = null;
                                                }
                                                <div class="product-price">
                                                    @if(ViewBag.DiscountPrice != null)
                                                {
                                                        <h4 class="text-white">
                                                            <s class="text-white">
                                                                @i.CarPrice
                                                            </s>
                                                        </h4>

                                                }
                                                else
                                                {
                                                        <h4 class="text-white">
                                                            @i.CarPrice
                                                        </h4>
                                                }
                                                    <h4 class="text-white">
                                                        @ViewBag.DiscountPrice
                                                    </h4>
                                                </div>
                                            }
                                        
                                        }*@
                                        <a asp-action="DetailsCarView" asp-controller="Car" asp-route-id="@i.ID" class="btn">
                                            <svg xmlns="http://www.w3.org/2000/svg" width="25" height="25" style="margin-left:4px; margin-right:8px; flex-direction: row-reverse;" fill="currentColor" class="bi bi-cart" viewBox="0 0 16 16">
                                                <path d="M0 1.5A.5.5 0 0 1 .5 1H2a.5.5 0 0 1 .485.379L2.89 3H14.5a.5.5 0 0 1 .491.592l-1.5 8A.5.5 0 0 1 13 12H4a.5.5 0 0 1-.491-.408L2.01 3.607 1.61 2H.5a.5.5 0 0 1-.5-.5zM3.102 4l1.313 7h8.17l1.313-7H3.102zM5 12a2 2 0 1 0 0 4 2 2 0 0 0 0-4zm7 0a2 2 0 1 0 0 4 2 2 0 0 0 0-4zm-7 1a1 1 0 1 1 0 2 1 1 0 0 1 0-2zm7 0a1 1 0 1 1 0 2 1 1 0 0 1 0-2z"/>
                                            </svg>
                                        </a>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                }
             </div>
            <div class="row" id="myDIV">
                @foreach (var i in Model)
                {
                    <div class="col-md-6 col-lg-4 col-xl-3">
                        <div class="MySingle-product mt-3 mb-3">

                            <div class="product-Photo">
                                <a asp-action="ShowPartialView" asp-controller="Home" asp-route-id="@i.ID"><img src="~/CarImages/@i.PhotoCar"/></a>
                            </div>
                            
                            <div class="product-Details">
                                <a style="text-decoration:none;" asp-action="DetailsCarView" asp-controller="Car" asp-route-id="@i.ID">
                                    <h3 class="product-title text-white">@i.CarName</h3>
                                </a>
                                <div class="product-addons-Details d-flex justify-content-between">
                                    <h2 class="product-title text-white">@i.CarPrice</h2>
                                    @*@{
                                        ViewBag.DiscountPrice = DiscountCounter.GetDiscount(i);
                                        if(ware.Value <= 0)
                                        {
                                                <h2 class="text-white">
                                                    Отсутствует в продаже
                                                </h2>
                                                <div class="product-price">
                                                </div>
                                        }
                                        else
                                        {
                                            if(ViewBag.DiscountPrice == 0)
                                            {
                                                ViewBag.DiscountPrice = null;
                                            }
                                                <div class="product-price">
                                                    @if(ViewBag.DiscountPrice != null)
                                                {
                                                        <h2 class="text-white">
                                                            <s class="text-white">
                                                                @i.FullPrice
                                                            </s>
                                                        </h2>
                                                }
                                                else
                                                {
                                                        <h2 class="text-white">
                                                            @i.FullPrice
                                                        </h2>
                                                }
                                                    <h4 class="text-white">
                                                        @ViewBag.DiscountPrice
                                                    </h4>
                                                </div>
                                        }                            
                                     }*@
                                   @*<div class="product-links">
                                        <a href="#"><i class="fas fa-heart"></i></a>
                                        <a href="#"><i class="fa fa-cart-plus"></i></a>
                                    </div>*@

                                </div>
                            </div>

                            @*<div class="part-1">
                                <ul>
								    <li><a href="#"><i class="fas fa-shopping-cart"></i></a></li>
								    <li><a href="#"><i class="fas fa-heart"></i></a></li>
								    <li><a href="#"><i class="fas fa-plus"></i></a></li>
								    <li><a href="#"><i class="fas fa-expand"></i></a></li>
						        </ul>
                            </div>

                            <div class="part-2">
                                <h3 class="product-title">@i.CarName</h3>
                                <h3 class="product-title">@i.CarPrice</h3>
                            </div>*@

                        </div>
                    </div>
                }
            </div>

        </div>
    </section>

</div>

@*@section Scripts{
    <script type="text/javascript">
        function openSuccessModal(strMessage){
            var myDiv = document.getElementById("MyModalSuccessAlertBody");
            myDiv.innerHTML = strMessage;
            $('#myModalSuccess').modal('show');
        }

        $(document).ready(function() {
            var msg = "@TempData["SuccessMessage"]";
            if (msg)
                openSuccessModal(msg);

        })
    </script>
}*@